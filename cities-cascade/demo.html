<script src="../static/tools.js"></script>
<script src="../static/events.js"></script>
<script src="./citiesData.js"></script>

<div id="dv">

  <select name="province" id="province"></select>
  <select name="city" id="city"></select>
  <select name="area" id="area"></select>

</div>

<script>

  var cityCascade = (function (context) {
    var Config = {
      data: null,
      // 1:select选择器; 2:仿京东城市选择器
      type: '1',
      province: {
        el: null,
        show: true,
        select: [],
        disabled: []
      },
      city: {
        el: null,
        show: true,
        select: [],
        disabled: []
      },
      area: {
        el: null,
        show: true,
        select: [],
        disabled: []
      },
      normalHTML: '<option value="-1">-请选择-</option>'
    };

    function Classes(options) {
      var that = this;
      extend(true, that, Config, options);
      if (!that.data) {
        return;
      }
      that.init();
    }

    Classes.prototype = {
      constructor: Classes,

      init: function () {
        var that = this;

        if (that.province.show) {
          that.viewProvince();
          kevent.add('change', that.province.el, function () {
            that.viewCity();
            that.clearViewArea();
          });
        }

        if (that.city.show) {
          that.viewCity();
          kevent.add('change', that.city.el, function () {
            that.viewArea();
          });
        }

        if (that.area.show) {
          that.viewArea();
        }
      },

      viewProvince: function () {
        var that = this;
        var data = that.data.provinces || {};
        var current = that.province || {};
        var r = [that.normalHTML];
        for (var k in data) {
          if (!data.hasOwnProperty(k) || !data[k]) {
            continue;
          }
          r.push('<option value="' + k + '">' + data[k] + '</option>');
        }
        current.el.innerHTML = r.join('');
      },

      viewCity: function () {
        var that = this;
        var data = that.data.cities[that.province.el.value] || {};
        var current = that.city;
        var r = [that.normalHTML];
        for (var k in data) {
          if (!data.hasOwnProperty(k) || !data[k]) {
            continue;
          }
          r.push('<option value="' + k + '">' + data[k] + '</option>');
        }
        current.el.innerHTML = r.join('');
      },

      clearViewCity: function () {
        this.city.el.innerHTML = this.normalHTML;
      },

      viewArea: function () {
        var that = this;
        var data = that.data.areas[that.city.el.value] || {};
        var current = that.area;
        var r = [that.normalHTML];
        for (var k in data) {
          if (!data.hasOwnProperty(k) || !data[k]) {
            continue;
          }
          r.push('<option value="' + k + '">' + data[k] + '</option>');
        }
        current.el.innerHTML = r.join('');
      },

      clearViewArea: function () {
        this.area.el.innerHTML = this.normalHTML;
      }
    };

    return function (options) {
      return new Classes(options);
    };
  })(window);
</script>

<script>
  console.log(
    cityCascade({
      data: CITIES_DATA,
      province: { el: document.getElementById('province') },
      city: { el: document.getElementById('city') },
      area: { el: document.getElementById('area') }
    })
  );
</script>